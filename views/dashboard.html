<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
</head>
<body>
  <h2 id="welcome"></h2>

  <div id="adminPanel" style="display: none;">
    <h3>Admin Tools</h3>
    <ul>
      <li><a href="/admin/create.html">Manage Users</a></li>
      <li><a href="/admin/logs.html">View Logs</a></li>
    </ul>
  </div>

  <div id="userPanel" style="display: none;">
    <h3>User Dashboard</h3>
    <p>Welcome to your profile page.</p>
    <li><a href="#" onclick="viewProfile()">View Profile</a></li>
  </div>

  <pre id="result" style="margin-top: 20px; color: green;"></pre>

  <script>
    const user = JSON.parse(localStorage.getItem("user"));
    const token = localStorage.getItem("token");
    const result = document.getElementById("result");

    if (!user || !token) {
      alert("Please login first");
      window.location.href = "/login.html";
    }

    document.getElementById("welcome").textContent = `Welcome ${user.username}`;

    if (user.role === "admin") {
      document.getElementById("adminPanel").style.display = "block";
    } else {
      document.getElementById("userPanel").style.display = "block";
    }

    async function viewProfile() {
      try {
        const response = await fetch(`https://games-database-main.onrender.com/user/${user.uid}`, {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${token}`
          }
        });

        const data = await response.json();

        if (response.ok) {
          result.textContent = JSON.stringify(data, null, 2);
        } else {
          result.textContent = `❌ Error: ${data.message || "Unknown error"}`;
        }
      } catch (err) {
        result.textContent = "❌ Error: " + err.message;
      }
    }
  </script>
</body>
</html>
